<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å››å·æœˆç›¸æŸ¥è¯¢å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Arial', sans-serif;
      color: #232526;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    /* å¤œç©ºæ˜Ÿç‚¹ */
    body::before {
      content: '';
      position: absolute;
      left: 0; top: 0; right: 0; bottom: 0;
      pointer-events: none;
      background: url('data:image/svg+xml;utf8,<svg width="100%25" height="100%25" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="20" r="1.2" fill="white" opacity="0.7"/><circle cx="80" cy="60" r="0.8" fill="white" opacity="0.5"/><circle cx="200" cy="120" r="1.5" fill="white" opacity="0.8"/><circle cx="300" cy="40" r="1" fill="white" opacity="0.6"/><circle cx="400" cy="200" r="1.1" fill="white" opacity="0.7"/><circle cx="600" cy="100" r="0.7" fill="white" opacity="0.4"/><circle cx="700" cy="300" r="1.3" fill="white" opacity="0.6"/></svg>');
      z-index: 0;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      padding: 40px;
      max-width: 650px;
      width: 100%;
      backdrop-filter: blur(10px);
      z-index: 1;
      color: #232526;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 2.2rem;
      color: #4e54c8;
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .header p {
      color: #6c7a89;
      font-size: 1rem;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-size: 0.9rem;
      color: #34495e;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    select, input[type="date"] {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e6ed;
      border-radius: 12px;
      background: #fff;
      color: #2c3e50;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    select:focus, input[type="date"]:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    select:disabled {
      background: #f8f9fa;
      color: #95a5a6;
      cursor: not-allowed;
    }
    
    button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .result {
      margin-top: 30px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      display: none;
      animation: slideIn 0.5s ease;
    }
    
    .result.show {
      display: block;
    }
    
    .location-info {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    
    .location-info h3 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 1.2rem;
    }
    
    .location-info p {
      color: #7f8c8d;
      margin-bottom: 5px;
    }
    
    .moon-phases {
      display: flex;
      flex-direction: row;
      gap: 18px;
      border: 1px solid #e0e6ed;
      padding: 14px 8px;
      background: #f8f9fa;
      margin-bottom: 0;
      overflow-x: auto;
      scrollbar-width: thin;
      scrollbar-color: #b0b3b8 #f8f9fa;
    }
    .moon-day {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 14px;
      padding: 15px 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 120px;
      max-width: 160px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      transition: transform 0.2s, box-shadow 0.2s;
      border: 2px solid transparent;
      color: #232526;
      font-size: 1rem;
    }
    @media (max-width: 700px) {
      .container { padding: 10px; }
      .moon-phases {
        gap: 8px;
        padding: 6px 2px;
      }
      .moon-day {
        min-width: 90px;
        max-width: 120px;
        padding: 8px 2px;
        font-size: 0.92rem;
      }
      .moon-emoji { font-size: 1.5rem; }
      .moon-date { font-size: 0.92rem; }
      .moon-phase { font-size: 0.8rem; }
    }
    
    .moon-day:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(142, 148, 251, 0.13);
    }
    
    .moon-day.selected {
      border: 2.5px solid #4e54c8;
      background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
      color: #232526;
    }
    
    .moon-emoji {
      font-size: 2.2rem;
      min-width: 40px;
      text-align: center;
      margin-bottom: 8px;
    }
    
    .moon-info {
      flex: 1;
      text-align: center;
    }
    
    .moon-date {
      font-weight: 600;
      color: #4e54c8;
      font-size: 1rem;
    }
    
    .moon-phase {
      color: #6c7a89;
      font-size: 0.95rem;
      margin-top: 2px;
    }
    
    .today {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }
    
    .today .moon-date,
    .today .moon-phase {
      color: #fff;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #7f8c8d;
    }
    
    .error {
      background: #fee;
      color: #c33;
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      border: 1px solid #fcc;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸŒ™ å››å·æœˆç›¸æŸ¥è¯¢</h1>
      <p>ä»Šå¤©æœˆäº®ç¼ºäº†ç‚¹å„¿å—ï¼Ÿ</p>
    </div>
    
    <form id="moonForm">
      <div class="form-group">
        <label for="city">é€‰æ‹©åŸå¸‚</label>
        <select id="city" required>
          <option value="">è¯·é€‰æ‹©åŸå¸‚</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="district">é€‰æ‹©åŒºå¿</label>
        <select id="district" required disabled>
          <option value="">è¯·å…ˆé€‰æ‹©åŸå¸‚</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="date">é€‰æ‹©æ—¥æœŸ</label>
        <input type="date" id="date" required max="">
      </div>
      
      <button type="submit">ğŸ” æŸ¥è¯¢æœˆç›¸</button>
    </form>
    
    <div id="result" class="result">
      <div class="location-info">
        <h3>ğŸ“ æŸ¥è¯¢ä½ç½®</h3>
        <p id="locationText"></p>
        <p id="dateText"></p>
      </div>
      <div class="moon-phases" id="moonPhases">
        <!-- æœˆç›¸ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
      </div>
    </div>
  </div>

  <script>
    // å››å·åŸå¸‚å’ŒåŒºå¿æ•°æ®
    const sichuanData = {
      "æˆéƒ½å¸‚": ["é”¦æ±ŸåŒº", "é’ç¾ŠåŒº", "é‡‘ç‰›åŒº", "æ­¦ä¾¯åŒº", "æˆååŒº", "é¾™æ³‰é©¿åŒº", "é’ç™½æ±ŸåŒº", "æ–°éƒ½åŒº", "æ¸©æ±ŸåŒº", "åŒæµåŒº", "éƒ«éƒ½åŒº", "æ–°æ´¥åŒº", "é‡‘å ‚å¿", "å¤§é‚‘å¿", "è’²æ±Ÿå¿", "éƒ½æ±Ÿå °å¸‚", "å½­å·å¸‚", "é‚›å´ƒå¸‚", "å´‡å·å¸‚", "ç®€é˜³å¸‚"],
      "ç»µé˜³å¸‚": ["æ¶ªåŸåŒº", "æ¸¸ä»™åŒº", "å®‰å·åŒº", "ä¸‰å°å¿", "ç›äº­å¿", "æ¢“æ½¼å¿", "åŒ—å·ç¾Œæ—è‡ªæ²»å¿", "å¹³æ­¦å¿", "æ±Ÿæ²¹å¸‚"],
      "å¾·é˜³å¸‚": ["æ—Œé˜³åŒº", "ç½—æ±ŸåŒº", "ä¸­æ±Ÿå¿", "å¹¿æ±‰å¸‚", "ä»€é‚¡å¸‚", "ç»µç«¹å¸‚"],
      "è‡ªè´¡å¸‚": ["è‡ªæµäº•åŒº", "è´¡äº•åŒº", "å¤§å®‰åŒº", "æ²¿æ»©åŒº", "è£å¿", "å¯Œé¡ºå¿"],
      "æ”€æèŠ±å¸‚": ["ä¸œåŒº", "è¥¿åŒº", "ä»å’ŒåŒº", "ç±³æ˜“å¿", "ç›è¾¹å¿"],
      "æ³¸å·å¸‚": ["æ±Ÿé˜³åŒº", "çº³æºªåŒº", "é¾™é©¬æ½­åŒº", "æ³¸å¿", "åˆæ±Ÿå¿", "å™æ°¸å¿", "å¤è”ºå¿"],
      "å†…æ±Ÿå¸‚": ["å¸‚ä¸­åŒº", "ä¸œå…´åŒº", "å¨è¿œå¿", "èµ„ä¸­å¿", "éš†æ˜Œå¸‚"],
      "ä¹å±±å¸‚": ["å¸‚ä¸­åŒº", "æ²™æ¹¾åŒº", "äº”é€šæ¡¥åŒº", "é‡‘å£æ²³åŒº", "çŠä¸ºå¿", "äº•ç ”å¿", "å¤¹æ±Ÿå¿", "æ²å·å¿", "å³¨è¾¹å½æ—è‡ªæ²»å¿", "é©¬è¾¹å½æ—è‡ªæ²»å¿", "å³¨çœ‰å±±å¸‚"],
      "å—å……å¸‚": ["é¡ºåº†åŒº", "é«˜åªåŒº", "å˜‰é™µåŒº", "å—éƒ¨å¿", "è¥å±±å¿", "è“¬å®‰å¿", "ä»ªé™‡å¿", "è¥¿å……å¿", "é˜†ä¸­å¸‚"],
      "å®œå®¾å¸‚": ["ç¿ å±åŒº", "å—æºªåŒº", "å™å·åŒº", "æ±Ÿå®‰å¿", "é•¿å®å¿", "é«˜å¿", "ç™å¿", "ç­ è¿å¿", "å…´æ–‡å¿", "å±å±±å¿"],
      "å¹¿å®‰å¸‚": ["å¹¿å®‰åŒº", "å‰é”‹åŒº", "å²³æ± å¿", "æ­¦èƒœå¿", "é‚»æ°´å¿", "åè“¥å¸‚"],
      "è¾¾å·å¸‚": ["é€šå·åŒº", "è¾¾å·åŒº", "å®£æ±‰å¿", "å¼€æ±Ÿå¿", "å¤§ç«¹å¿", "æ¸ å¿", "ä¸‡æºå¸‚"],
      "é›…å®‰å¸‚": ["é›¨åŸåŒº", "åå±±åŒº", "è¥ç»å¿", "æ±‰æºå¿", "çŸ³æ£‰å¿", "å¤©å…¨å¿", "èŠ¦å±±å¿", "å®å…´å¿"],
      "å·´ä¸­å¸‚": ["å·´å·åŒº", "æ©é˜³åŒº", "é€šæ±Ÿå¿", "å—æ±Ÿå¿", "å¹³æ˜Œå¿"],
      "èµ„é˜³å¸‚": ["é›æ±ŸåŒº", "å®‰å²³å¿", "ä¹è‡³å¿"],
      "é˜¿åè—æ—ç¾Œæ—è‡ªæ²»å·": ["é©¬å°”åº·å¸‚", "æ±¶å·å¿", "ç†å¿", "èŒ‚å¿", "æ¾æ½˜å¿", "ä¹å¯¨æ²Ÿå¿", "é‡‘å·å¿", "å°é‡‘å¿", "é»‘æ°´å¿", "å£¤å¡˜å¿", "é˜¿åå¿", "è‹¥å°”ç›–å¿", "çº¢åŸå¿"],
      "ç”˜å­œè—æ—è‡ªæ²»å·": ["åº·å®šå¸‚", "æ³¸å®šå¿", "ä¸¹å·´å¿", "ä¹é¾™å¿", "é›…æ±Ÿå¿", "é“å­šå¿", "ç‚‰éœå¿", "ç”˜å­œå¿", "æ–°é¾™å¿", "å¾·æ ¼å¿", "ç™½ç‰å¿", "çŸ³æ¸ å¿", "è‰²è¾¾å¿", "ç†å¡˜å¿", "å·´å¡˜å¿", "ä¹¡åŸå¿", "ç¨»åŸå¿", "å¾—è£å¿"],
      "å‡‰å±±å½æ—è‡ªæ²»å·": ["è¥¿æ˜Œå¸‚", "æœ¨é‡Œè—æ—è‡ªæ²»å¿", "ç›æºå¿", "å¾·æ˜Œå¿", "ä¼šç†å¸‚", "ä¼šä¸œå¿", "å®å—å¿", "æ™®æ ¼å¿", "å¸ƒæ‹–å¿", "é‡‘é˜³å¿", "æ˜­è§‰å¿", "å–œå¾·å¿", "å†•å®å¿", "è¶Šè¥¿å¿", "ç”˜æ´›å¿", "ç¾å§‘å¿", "é›·æ³¢å¿"]
    };

    // DOM å…ƒç´ 
    const citySelect = document.getElementById('city');
    const districtSelect = document.getElementById('district');
    const dateInput = document.getElementById('date');
    const resultDiv = document.getElementById('result');
    const locationText = document.getElementById('locationText');
    const dateText = document.getElementById('dateText');
    const moonPhasesDiv = document.getElementById('moonPhases');

    // è®¾ç½®æœ€å¤§æ—¥æœŸä¸ºä»Šå¤©
    dateInput.max = new Date().toISOString().split('T')[0];
    dateInput.value = new Date().toISOString().split('T')[0];

    // åˆå§‹åŒ–åŸå¸‚é€‰æ‹©
    function initCitySelect() {
      citySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŸå¸‚</option>';
      Object.keys(sichuanData).forEach(city => {
        const opt = document.createElement('option');
        opt.value = city;
        opt.textContent = city;
        citySelect.appendChild(opt);
      });
    }

    // åŸå¸‚é€‰æ‹©äº‹ä»¶
    citySelect.addEventListener('change', function() {
      const city = this.value;
      districtSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŒºå¿</option>';
      districtSelect.disabled = true;
      
      if (city && sichuanData[city]) {
        sichuanData[city].forEach(district => {
          const opt = document.createElement('option');
          opt.value = district;
          opt.textContent = district;
          districtSelect.appendChild(opt);
        });
        districtSelect.disabled = false;
      }
    });

    // æœˆç›¸è®¡ç®—å‡½æ•°
    function getMoonPhase(date) {
      let year = date.getFullYear();
      let month = date.getMonth() + 1;
      const day = date.getDate();
      
      let c = 0, e = 0, jd = 0, b = 0;
      
      if (month < 3) {
        year--;
        month += 12;
      }
      
      ++month;
      c = 365.25 * year;
      e = 30.6 * month;
      jd = c + e + day - 694039.09;
      jd /= 29.5305882;
      b = parseInt(jd);
      jd -= b;
      b = Math.round(jd * 8);
      
      if (b >= 8) b = 0;
      
      return b;
    }

    // æœˆç›¸ä¿¡æ¯
    const moonPhases = [
      { name: "æ–°æœˆ", emoji: "ğŸŒ‘", description: "æœˆäº®ä¸å¯è§" },
      { name: "å³¨çœ‰æœˆ", emoji: "ğŸŒ’", description: "ç»†å¼¯æœˆ" },
      { name: "ä¸Šå¼¦æœˆ", emoji: "ğŸŒ“", description: "åŠåœ†æœˆ" },
      { name: "ç›ˆå‡¸æœˆ", emoji: "ğŸŒ”", description: "å‡¸æœˆ" },
      { name: "æ»¡æœˆ", emoji: "ğŸŒ•", description: "åœ†æœˆ" },
      { name: "äºå‡¸æœˆ", emoji: "ğŸŒ–", description: "å‡¸æœˆ" },
      { name: "ä¸‹å¼¦æœˆ", emoji: "ğŸŒ—", description: "åŠåœ†æœˆ" },
      { name: "æ®‹æœˆ", emoji: "ğŸŒ˜", description: "ç»†å¼¯æœˆ" }
    ];

    function getPhaseInfo(phaseNum) {
      return moonPhases[phaseNum];
    }

    // æŸ¥è¯¢æœˆç›¸
    document.getElementById('moonForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const city = citySelect.value;
      const district = districtSelect.value;
      const dateStr = dateInput.value;
      
      if (!city || !district || !dateStr) {
        alert('è¯·å®Œæ•´é€‰æ‹©æ‰€æœ‰é€‰é¡¹');
        return;
      }

      // æ˜¾ç¤ºç»“æœåŒºåŸŸ
      resultDiv.classList.add('show');
      
      // æ›´æ–°ä½ç½®ä¿¡æ¯
      locationText.textContent = `å››å·çœ ${city} ${district}`;
      dateText.textContent = `æŸ¥è¯¢æ—¥æœŸï¼š${dateStr}`;
      
      // è®¡ç®—æœˆç›¸
      const baseDate = new Date(dateStr);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      moonPhasesDiv.innerHTML = '';
      
      for (let offset = -3; offset <= 3; offset++) {
        const d = new Date(baseDate);
        d.setDate(baseDate.getDate() + offset);
        const phaseNum = getMoonPhase(d);
        const phase = getPhaseInfo(phaseNum);
        
        // æŸ¥è¯¢æ—¥æœŸé«˜äº®
        const isSelected = d.getTime() === baseDate.getTime();
        const dayClass = isSelected ? 'moon-day selected' : 'moon-day';
        
        const dayDiv = document.createElement('div');
        dayDiv.className = dayClass;
        dayDiv.innerHTML = `
          <div class="moon-emoji">${phase.emoji}</div>
          <div class="moon-info">
            <div class="moon-date">${d.toLocaleDateString('zh-CN')} ${isSelected ? '(æŸ¥è¯¢æ—¥)' : ''}</div>
            <div class="moon-phase">${phase.name} - ${phase.description}</div>
          </div>
        `;
        
        moonPhasesDiv.appendChild(dayDiv);
      }
      
      // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
      resultDiv.scrollIntoView({ behavior: 'smooth' });
    });

    // åˆå§‹åŒ–
    initCitySelect();
    
  </script>
</body>
</html>
